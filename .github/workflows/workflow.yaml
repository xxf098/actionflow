name: flow
on:
  push:
    branches:   
      - master
    paths-ignore:
      - '**.md'
      - "**.cue"
      - '**_test.go'      

jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps: 
      - name: Check out code into the Go module directory
        uses: actions/checkout@v3
      - name: Pre
        run: |
          ls
          curl -L https://free.keep.sh/YX7SEDElvnALUvuu/flow --output flow
          chmod +X flow
          mkdir temp2;mv flow ./temp2
          cd temp2
          ./flow init 
          ./flow update
          cp ../testcues/step.cue ./
          sed -i '1 s/^.*$/package main/' step.cue
          ./flow do setup
          echo "$PATH"
          go version

      - name: Setup Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.18
          cache: false

      - name: Build
        run: |
          go mod tidy
          make flow
          ls

      - name: Exec
        run: |
          mkdir temp1;mv ./cmd/flow ./temp1
          cd temp1
          ./flow init 
          ./flow update
          ./flow do mkdir
          test -d ./hello
   